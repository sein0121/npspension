<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="NpsPen0002Sql">

  <select id="selectNpsPen0002" resultType="java.util.HashMap">
    <![CDATA[
      SELECT * FROM NPSPEN0002
    ]]>
  </select>

  <insert id="insertNpsPen0002">
    <![CDATA[
      INSERT INTO NPSPEN0002 (REQUEST_ID, REQ_DT, FILE_NM, PAGE_NUM, CATEGORY, PRO_STATUS, REG_DT)
      VALUES (
        #{requestId}
        , #{reqDt}
        , #{fileNm}
        , #{pageNum}
        , #{category}
        , #{proStatus}
        , #{regDt}
      )
    ]]>
  </insert>

  <insert id="insertFileAdd">
    <![CDATA[
      INSERT INTO NPSPEN0002
      VALUES (
        #{requestId},
        (SELECT MAX(REQ_DT) AS REQ_DT FROM NPSPEN0001 WHERE REQUEST_ID = #{requestId}),
        #{fileNm},
        #{pageNum},
        #{category},
        #{proStatus},
        (SELECT MAX(REQ_DT) AS REG_DT FROM NPSPEN0001 WHERE REQUEST_ID = #{requestId})
      )
    ]]>
  </insert>

  <update id="updateNpsPen0002">
    <![CDATA[
      UPDATE NPSPEN0002
      SET PAGE_NUM = #{pageNum}
        , CATEGORY = #{category}
        , PRO_STATUS = #{proStatus}
      WHERE REQUEST_ID = #{requestId}
        AND FILE_NM = #{fileNm}
        AND PAGE_NUM = 0
        AND REQ_DT = (
          SELECT REQ_DT FROM (
           SELECT
              MAX(REQ_DT) AS REQ_DT
           FROM NPSPEN0001
           WHERE REQUEST_ID = #{requestId}
         ) TMP_TABLE
      )
    ]]>
  </update>

</mapper>